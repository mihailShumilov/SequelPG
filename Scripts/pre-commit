#!/bin/bash
# Pre-commit hook: runs SwiftFormat on staged Swift files.
# Install: cp Scripts/pre-commit .git/hooks/pre-commit && chmod +x .git/hooks/pre-commit

set -euo pipefail

if ! command -v swiftformat &> /dev/null; then
    echo "Warning: swiftformat not installed, skipping format check."
    exit 0
fi

STAGED_SWIFT_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.swift$' || true)

if [ -z "$STAGED_SWIFT_FILES" ]; then
    exit 0
fi

echo "Running SwiftFormat on staged files..."
echo "$STAGED_SWIFT_FILES" | xargs swiftformat --config .swiftformat

# Re-stage formatted files
echo "$STAGED_SWIFT_FILES" | xargs git add

echo "SwiftFormat complete."
